var randomBytes = require('crypto').randomBytes
  , byteMap = [];

for (var i = 0; i < 256; i++) {
  byteMap[i] = (i + 0x100).toString(16).substr(1);
}

exports = module.exports = function (raw) {
  var bytes = randomBytes(16);

  bytes[6] = (bytes[6] & 0x0f) | 0x40;
  bytes[8] = (bytes[8] & 0x3f) | 0x80;

  if (raw) {
    var buf = new Buffer(bytes);
    return buf;
  } else {
    return exports.toString(bytes);
  }
};

exports.toString = function (arr) {
  var bm = byteMap
    , i = 0;
  return '' +
    bm[arr[i++]] + bm[arr[i++]] +
    bm[arr[i++]] + bm[arr[i++]] + '-' +
    bm[arr[i++]] + bm[arr[i++]] + '-' +
    bm[arr[i++]] + bm[arr[i++]] + '-' +
    bm[arr[i++]] + bm[arr[i++]] + '-' +
    bm[arr[i++]] + bm[arr[i++]] +
    bm[arr[i++]] + bm[arr[i++]] +
    bm[arr[i++]] + bm[arr[i++]];
};
